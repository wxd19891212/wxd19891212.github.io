
<!DOCTYPE html>
<html lang="zh-cn">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="XiaoDong">
    <title>用Runtime简单模拟实现KVO（附Demo） - XiaoDong</title>
    <meta name="author" content="XiaoDong Wang">
    
    
        <link rel="icon" href="http://blog.xiaodongwang.com/assets/images/bitbug_favicon.ico">
    
    
        <link rel="alternate" type="application/atom+xml" title="RSS" href="/atom.xml">
    
    <meta name="description" content="KVO相信iOS开发者们都听说过,在面试中也会被常常问到,但是呢对于KVO来说更多的事情是由系统来做的,依赖于运行时,相对于Notification,delegate来说是比较简单的,提供观察属性旧值与新值,以下单纯的说下自己对KVO的实现原理粗略理解,用Runtime简单模拟实现KVO。">
<meta name="keywords" content="减耦合,KVO">
<meta property="og:type" content="blog">
<meta property="og:title" content="用Runtime简单模拟实现KVO（附Demo）">
<meta property="og:url" content="http://blog.xiaodongwang.com/2017/10/10/61606/index.html">
<meta property="og:site_name" content="XiaoDong">
<meta property="og:description" content="KVO相信iOS开发者们都听说过,在面试中也会被常常问到,但是呢对于KVO来说更多的事情是由系统来做的,依赖于运行时,相对于Notification,delegate来说是比较简单的,提供观察属性旧值与新值,以下单纯的说下自己对KVO的实现原理粗略理解,用Runtime简单模拟实现KVO。">
<meta property="og:locale" content="zh-cn">
<meta property="og:updated_time" content="2018-05-17T12:18:27.351Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="用Runtime简单模拟实现KVO（附Demo）">
<meta name="twitter:description" content="KVO相信iOS开发者们都听说过,在面试中也会被常常问到,但是呢对于KVO来说更多的事情是由系统来做的,依赖于运行时,相对于Notification,delegate来说是比较简单的,提供观察属性旧值与新值,以下单纯的说下自己对KVO的实现原理粗略理解,用Runtime简单模拟实现KVO。">
    
    
        
    
    
        <meta property="og:image" content="http://blog.xiaodongwang.com/assets/images/WechatIMG72.jpeg"/>
    
    
    
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/style-bof0arfuf492d2ojltoawpmiirc6dutqwguvrg4y85i6km7st1t5r7xltp0f.min.css">
    <!--STYLES END-->
    

    
    <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?c7edef1c5ae1081f28fb9efbf5d633ab";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="4">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a class="header-title-link" href="/ ">XiaoDong</a>
    </div>
    
        
            <a  class="header-right-picture "
                href="#about">
        
        
            <img class="header-picture" src="/assets/images/WechatIMG72.jpeg" alt="作者的图片"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="4">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a href="/#about">
                    <img class="sidebar-profile-picture" src="/assets/images/WechatIMG72.jpeg" alt="作者的图片"/>
                </a>
                <h4 class="sidebar-profile-name">XiaoDong Wang</h4>
                
                    <h5 class="sidebar-profile-bio"><p>If you are still looking for that one person who will change your life ，take a look in the mirror</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/ "
                            
                            title="首页"
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">首页</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-categories"
                            
                            title="分类"
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">分类</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-tags"
                            
                            title="标签"
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">标签</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-archives"
                            
                            title="归档"
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">归档</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link open-algolia-search"
                             href="#search"
                            
                            title="搜索"
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-search" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">搜索</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/about"
                            
                            title="关于"
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">关于</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://github.com/wxd19891212" target="_blank" rel="noopener" title="GitHub">
                    
                        <i class="sidebar-button-icon fa fa-lg fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="mailto:job@xiaodongwang.com" target="_blank" rel="noopener" title="邮箱">
                    
                        <i class="sidebar-button-icon fa fa-lg fa-envelope-o" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">邮箱</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/atom.xml"
                            
                            title="RSS"
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="4"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post" itemscope itemType="http://schema.org/BlogPosting">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title" itemprop="headline">
            用Runtime简单模拟实现KVO（附Demo）
        </h1>
    
    
        <div class="post-meta">
    <time itemprop="datePublished" datetime="2017-10-10T10:14:32+08:00">
	
		    10月 10, 2017
    	
    </time>
    
        <span>发布在 </span>
        
    <a class="category-link" href="/categories/设计模式/">设计模式</a>, <a class="category-link" href="/categories/设计模式/iOS/">iOS</a>


    
</div>

    
</div>
    
    <div class="post-content markdown" itemprop="articleBody">
        <div class="main-content-wrap">
            <p>KVO相信iOS开发者们都听说过,在面试中也会被常常问到,但是呢对于KVO来说更多的事情是由系统来做的,依赖于运行时,相对于Notification,delegate来说是比较简单的,提供观察属性旧值与新值,以下单纯的说下自己对KVO的实现原理粗略理解,用Runtime简单模拟实现KVO。<br><a id="more"></a><br><h1 id="table-of-contents">目录</h1><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#KVO是什么"><span class="toc-text">KVO是什么</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#实现原理"><span class="toc-text">实现原理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#基本的原理："><span class="toc-text">基本的原理：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#深入剖析："><span class="toc-text">深入剖析：</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#回调相关问题"><span class="toc-text">回调相关问题</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#最后"><span class="toc-text">最后</span></a></li></ol></p>
<h1 id="KVO是什么"><a href="#KVO是什么" class="headerlink" title="KVO是什么"></a>KVO是什么</h1><p>KVO 是 Objective-C 对观察者模式（Observer Pattern）的实现。也是 Cocoa Binding 的基础。当被观察对象的某个属性发生更改时，观察者对象会获得通知。</p>
<h1 id="实现原理"><a href="#实现原理" class="headerlink" title="实现原理"></a>实现原理</h1><p>KVO 在 Apple 中的 API 文档如下：</p>
<blockquote>
<p>Automatic key-value observing is implemented using a technique called isa-swizzling… When an observer is registered for an attribute of an object the isa pointer of the observed object is modified, pointing to an intermediate class rather than at the true class …</p>
</blockquote>
<p>KVO 的实现依赖于 Objective-C 强大的 Runtime，从以上 Apple 的文档可以看出苹果对于 KVO 机制的实现是一笔带过，而具体的细节没有过多的描述，但是我们可以通过 Runtime 的所提供的方法去探索关于KVO 机制的底层实现原理。</p>
<h2 id="基本的原理："><a href="#基本的原理：" class="headerlink" title="基本的原理："></a>基本的原理：</h2><p>KVO 是基于 runtime 运行时来实现的，当你观察了某个对象的属性，内部会生成一个该对象所属类的子类，然后从写被观察属性的setter方法，当然在重写的方法中会调用父类的setter方法从而不会影响框架使用者的逻辑，之后会将该对象的isa指针指向新创建的这个类，最后会重写-(Class)class;方法，让使用者通过[obj class]查看当前对象所属类的时候会返回其父类，达到移花接木的目的。<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSLog</span>(<span class="string">@"class-withOutKVO: %@ \n"</span>, object_getClass(<span class="keyword">self</span>.testObj));</div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@"setterAdress-withOutKVO: %p \n"</span>, [<span class="keyword">self</span>.testObj methodForSelector:<span class="keyword">@selector</span>(setName:)]);</div><div class="line">     </div><div class="line">[<span class="keyword">self</span>.testObj addObserver:<span class="keyword">self</span> forKeyPath:<span class="string">@"name"</span> options:<span class="built_in">NSKeyValueObservingOptionNew</span> |<span class="built_in">NSKeyValueObservingOptionOld</span> context: <span class="literal">nil</span>];</div><div class="line">[<span class="keyword">self</span>.testObj addObserver:<span class="keyword">self</span> forKeyPath:<span class="string">@"age"</span> options:<span class="built_in">NSKeyValueObservingOptionNew</span> |<span class="built_in">NSKeyValueObservingOptionOld</span> context: <span class="literal">nil</span>];</div><div class="line">     </div><div class="line">     </div><div class="line"><span class="keyword">self</span>.testObj.name = <span class="string">@"xxxx"</span>;</div><div class="line"><span class="keyword">self</span>.testObj.age = <span class="number">12</span>;</div><div class="line">     </div><div class="line">     </div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@"class-addKVO: %@ \n"</span>, object_getClass(<span class="keyword">self</span>.testObj));</div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@"setterAdress-addKVO: %p \n"</span>, [<span class="keyword">self</span>.testObj methodForSelector:<span class="keyword">@selector</span>(setName:)]);</div><div class="line">     </div><div class="line">[<span class="keyword">self</span>.testObj removeObserver:<span class="keyword">self</span> forKeyPath:<span class="string">@"name"</span>];</div><div class="line">[<span class="keyword">self</span>.testObj removeObserver:<span class="keyword">self</span> forKeyPath:<span class="string">@"age"</span>];</div><div class="line">     </div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@"class-removeKVO: %@"</span>, object_getClass(<span class="keyword">self</span>.testObj));</div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@"setterAdress-removeKVO: %p \n"</span>, [<span class="keyword">self</span>.testObj methodForSelector:<span class="keyword">@selector</span>(setName:)]);</div></pre></td></tr></table></figure></p>
<p>看到了么，我们使用object_getClass ()方法成功躲开了 KVO 的障眼法，发现添加观察过后，_obj的类变成了NSKVONotifying_TestObj，在移除观察过后，_obj的类又变回TestObj。同时，我们还观察了setAName:方法的地址，发现同样是有变化，同样验证了重写setter方法的逻辑。</p>
<h2 id="深入剖析："><a href="#深入剖析：" class="headerlink" title="深入剖析："></a>深入剖析：</h2><p>关键代码<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">BOOL</span>)wxd_coreLogicWithTarget:(<span class="keyword">id</span>)target getterName:(<span class="built_in">NSString</span> *)getterName &#123;</div><div class="line">    <span class="comment">//若 setter 不存在,根据属性名（也是getter的方法名）生成setter的方法名</span></div><div class="line">    <span class="built_in">NSString</span> *setterName = setterNameFromGetterName(getterName);</div><div class="line">    SEL setterSel = <span class="built_in">NSSelectorFromString</span>(setterName);</div><div class="line">    Method setterMethod = class_getInstanceMethod(object_getClass(target), setterSel);</div><div class="line">    <span class="keyword">if</span> (!setterMethod) <span class="keyword">return</span> <span class="literal">NO</span>;</div><div class="line">    <span class="comment">//创建派生类并且更改 isa 指针</span></div><div class="line">    [<span class="keyword">self</span> wxd_creatSubClassWithTarget:target];</div><div class="line">    <span class="comment">//给派生类添加 setter 方法体</span></div><div class="line">    <span class="keyword">if</span> (!classHasSel(object_getClass(target), setterSel)) &#123;</div><div class="line">        <span class="keyword">const</span> <span class="keyword">char</span> *types = method_getTypeEncoding(setterMethod);</div><div class="line">        <span class="keyword">return</span> class_addMethod(object_getClass(target), setterSel, (IMP)wxd_kvo_setter, types);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//创建派生类并且更改 isa 指针</span></div><div class="line">- (<span class="keyword">void</span>)wxd_creatSubClassWithTarget:(<span class="keyword">id</span>)target &#123;</div><div class="line">    <span class="comment">//获取被观察者的类</span></div><div class="line">    Class nowClass = object_getClass(target);</div><div class="line">    <span class="built_in">NSString</span> *nowClass_name = <span class="built_in">NSStringFromClass</span>(nowClass);</div><div class="line">    <span class="comment">//如果isa指针已经指向子类返回</span></div><div class="line">    <span class="keyword">if</span> ([nowClass_name hasPrefix:kPrefixOfWXDKVO]) &#123;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//动态生成新的子类类名</span></div><div class="line">    <span class="built_in">NSString</span> *subClass_name = [kPrefixOfWXDKVO stringByAppendingString:nowClass_name];</div><div class="line">    Class subClass = <span class="built_in">NSClassFromString</span>(subClass_name);</div><div class="line">    <span class="comment">//若派生类存在</span></div><div class="line">    <span class="keyword">if</span> (subClass) &#123;</div><div class="line">        <span class="comment">//将该对象 isa 指针指向派生类</span></div><div class="line">        object_setClass(target, subClass);</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//添加派生类，并且给派生类添加 class 方法体，其中nowClass是传进来的目标类</span></div><div class="line">    subClass = objc_allocateClassPair(nowClass, subClass_name.UTF8String, <span class="number">0</span>);</div><div class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *types = method_getTypeEncoding(class_getInstanceMethod(nowClass, <span class="keyword">@selector</span>(<span class="keyword">class</span>)));</div><div class="line">    IMP class_imp = imp_implementationWithBlock(^Class (<span class="keyword">id</span> target)&#123;</div><div class="line">        <span class="keyword">return</span> class_getSuperclass(object_getClass(target));</div><div class="line">    &#125;);</div><div class="line">    </div><div class="line">    class_addMethod(subClass, <span class="keyword">@selector</span>(<span class="keyword">class</span>), class_imp, types);</div><div class="line">    <span class="comment">//注册该类</span></div><div class="line">    objc_registerClassPair(subClass);</div><div class="line">    </div><div class="line">    <span class="comment">//将该对象 isa 指针指向派生类</span></div><div class="line">    object_setClass(target, subClass);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h1 id="回调相关问题"><a href="#回调相关问题" class="headerlink" title="回调相关问题"></a>回调相关问题</h1><p>接下来就是回调的情况了，在重写的setter里面逻辑是这样的：<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">static</span> <span class="keyword">void</span> wxd_kvo_setter (<span class="keyword">id</span> taget, SEL sel, <span class="keyword">id</span> p0) &#123;</div><div class="line">    <span class="comment">//拿到调用父类方法之前的值</span></div><div class="line">    <span class="built_in">NSString</span> *getterName = getterNameFromSetterName(<span class="built_in">NSStringFromSelector</span>(sel));</div><div class="line">    <span class="keyword">id</span> old = [taget valueForKey:getterName];</div><div class="line">    callBack(taget, <span class="literal">nil</span>, old, getterName, <span class="literal">YES</span>);</div><div class="line">    </div><div class="line">    <span class="comment">//给父类发送消息</span></div><div class="line">    <span class="keyword">struct</span> objc_super sup = &#123;</div><div class="line">        .receiver = taget,</div><div class="line">        .super_class = class_getSuperclass(object_getClass(taget))</div><div class="line">    &#125;;</div><div class="line">    ((<span class="keyword">void</span>(*)(<span class="keyword">struct</span> objc_super *, SEL, <span class="keyword">id</span>)) objc_msgSendSuper)(&amp;sup, sel, p0);</div><div class="line">    </div><div class="line">    callBack(taget, p0, old, getterName, <span class="literal">NO</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h1 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h1><p>以上介绍了 KVO 的实现原理并自己实现了一个简单的 KVO，源码 <a href="https://github.com/wxd19891212/WXD_KVO_DEMO" target="_blank" rel="external">KVO Demo</a>，感兴趣的可以下载下来看看。<br>实际上 KVO 的实现还是很复杂的，要考虑到很多地方，复杂的实现网上有相关代码，或者看 KVO 源码了解一下。</p>

            

        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">标签</span><br/>
                
    <a class="tag tag--primary tag--small t-link" href="/tags/KVO/">KVO</a> <a class="tag tag--primary tag--small t-link" href="/tags/减耦合/">减耦合</a>

            </div>
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2018/05/09/14007/" data-tooltip="iOS GCD信号量（附Demo）" aria-label="上一篇: iOS GCD信号量（附Demo）">
                
                    <i class="fa fa-angle-left" aria-hidden="true"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">上一篇</span>
                </a>
            </li>
            <li class="post-action">
                
                    
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2017/09/14/522/" data-tooltip="iOS Runtime 学习总结（附Demo）" aria-label="下一篇: iOS Runtime 学习总结（附Demo）">
                
                    <span class="hide-xs hide-sm text-small icon-mr">下一篇</span>
                    <i class="fa fa-angle-right" aria-hidden="true"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Diesen Beitrag teilen">
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="http://service.weibo.com/share/share.php?&amp;title=http://blog.xiaodongwang.com/2017/10/10/61606/" title="分享到 Weibo">
                    <i class="fa fa-weibo" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="http://connect.qq.com/widget/shareqq/index.html?url=http://blog.xiaodongwang.com/2017/10/10/61606/&amp;title=用Runtime简单模拟实现KVO（附Demo）" title="分享到 QQ">
                    <i class="fa fa-qq" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://blog.xiaodongwang.com/2017/10/10/61606/" title="分享到 Qzone">
                    <i class="fa fa-star" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
                <li class="post-action">
                    <a class="post-action-btn btn btn--default" href="#gitment">
                         <i class="fa fa-comment-o"></i>
                    </a>
                </li>
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#table-of-contents" aria-label="目录">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


        
        
            
                <div id="gitment"></div>
            
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2018 XiaoDong Wang. All Rights Reserved. | Hosted by <a href="https://pages.coding.me" target="_blank" style="color: #9eabb3">Coding Pages</a>
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2018/05/09/14007/" data-tooltip="iOS GCD信号量（附Demo）" aria-label="上一篇: iOS GCD信号量（附Demo）">
                
                    <i class="fa fa-angle-left" aria-hidden="true"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">上一篇</span>
                </a>
            </li>
            <li class="post-action">
                
                    
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2017/09/14/522/" data-tooltip="iOS Runtime 学习总结（附Demo）" aria-label="下一篇: iOS Runtime 学习总结（附Demo）">
                
                    <span class="hide-xs hide-sm text-small icon-mr">下一篇</span>
                    <i class="fa fa-angle-right" aria-hidden="true"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Diesen Beitrag teilen">
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="http://service.weibo.com/share/share.php?&amp;title=http://blog.xiaodongwang.com/2017/10/10/61606/" title="分享到 Weibo">
                    <i class="fa fa-weibo" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="http://connect.qq.com/widget/shareqq/index.html?url=http://blog.xiaodongwang.com/2017/10/10/61606/&amp;title=用Runtime简单模拟实现KVO（附Demo）" title="分享到 QQ">
                    <i class="fa fa-qq" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://blog.xiaodongwang.com/2017/10/10/61606/" title="分享到 Qzone">
                    <i class="fa fa-star" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
                <li class="post-action">
                    <a class="post-action-btn btn btn--default" href="#gitment">
                         <i class="fa fa-comment-o"></i>
                    </a>
                </li>
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#table-of-contents" aria-label="目录">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                <div id="share-options-bar" class="share-options-bar" data-behavior="4">
    <i id="btn-close-shareoptions" class="fa fa-close"></i>
    <ul class="share-options">
        
            
            
            <li class="share-option">
                <a class="share-option-btn" target="new" href="http://service.weibo.com/share/share.php?&amp;title=http://blog.xiaodongwang.com/2017/10/10/61606/">
                    <i class="fa fa-weibo" aria-hidden="true"></i><span>分享到 Weibo</span>
                </a>
            </li>
        
            
            
            <li class="share-option">
                <a class="share-option-btn" target="new" href="http://connect.qq.com/widget/shareqq/index.html?url=http://blog.xiaodongwang.com/2017/10/10/61606/&amp;title=用Runtime简单模拟实现KVO（附Demo）">
                    <i class="fa fa-qq" aria-hidden="true"></i><span>分享到 QQ</span>
                </a>
            </li>
        
            
            
            <li class="share-option">
                <a class="share-option-btn" target="new" href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://blog.xiaodongwang.com/2017/10/10/61606/">
                    <i class="fa fa-star" aria-hidden="true"></i><span>分享到 Qzone</span>
                </a>
            </li>
        
    </ul>
</div>

            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-remove"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/WechatIMG72.jpeg" alt="作者的图片"/>
        
            <h4 id="about-card-name">XiaoDong Wang</h4>
        
            <div id="about-card-bio"><p>If you are still looking for that one person who will change your life ，take a look in the mirror</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>Software Engineer, iOS</p>

            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker"></i>
                <br/>
                ShenZhen
            </div>
        
    </div>
</div>

        
            <div id="algolia-search-modal" class="modal-container">
    <div class="modal">
        <div class="modal-header">
            <span class="close-button"><i class="fa fa-close"></i></span>
            <a href="https://algolia.com" target="_blank" rel="noopener" class="searchby-algolia text-color-light link-unstyled">
                <span class="searchby-algolia-text text-color-light text-small">by</span>
                <img class="searchby-algolia-logo" src="https://www.algolia.com/static_assets/images/press/downloads/algolia-light.svg">
            </a>
            <i class="search-icon fa fa-search"></i>
            <form id="algolia-search-form">
                <input type="text" id="algolia-search-input" name="search"
                    class="form-control input--large search-input" placeholder="Search "
                    />
            </form>
        </div>
        <div class="modal-body">
            <div class="no-result text-color-light text-center">没有找到文章</div>
            <div class="results">
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://blog.xiaodongwang.com/2015/04/09/19497/">
                            <h3 class="media-heading">iOS - 关于数据持久化</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2015年4月9日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://blog.xiaodongwang.com/2015/04/09/15288/">
                            <h3 class="media-heading">iOS当中的Cache设计</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2015年4月9日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://blog.xiaodongwang.com/2015/04/11/39562/">
                            <h3 class="media-heading">内存管理</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2015年4月11日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>应用程序内存管理是在程序运行时分配内存的过程，使用它，并在完成后释放内存。一个写得好的程序尽可能少地使用内存。在Objective-C中，它也可以被看作是将有限的内存资源的所有权分配给许多数据和代码的一种方式。</div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://blog.xiaodongwang.com/2015/04/12/13545/">
                            <h3 class="media-heading">iOS异常</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2015年4月12日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>本文档讨论如何提升和处理异常：中断程序执行正常流程的特殊情况。iOS和OS X上提供了Objective-C指令和Foundation API异常。</div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://blog.xiaodongwang.com/2015/04/13/35096/">
                            <h3 class="media-heading">iOS并发编程指南</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2015年4月13日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>并发性是多个事物同时发生的概念。随着多核CPU的普及，以及每个处理器内核数量只会增加的认识，软件开发人员需要新的方法来利用它们。尽管OS X和iOS等操作系统能够并行运行多个程序，但大多数程序都是在后台运行并执行几乎不需要连续处理时间的任务。</div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://blog.xiaodongwang.com/2016/01/21/61733/">
                            <h3 class="media-heading">学习笔记内容迁移</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2016年1月21日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>为方便学习笔记的整理，今后本人的学习笔记会在个人网站——<a href="http://blog.xiaodongwang.com/">王晓东的个人博客</a>进行更新，感谢大家的支持。由于能力有限，可能会存在一些问题，欢迎大家批评指正。<br></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://blog.xiaodongwang.com/2016/03/02/12068/">
                            <h3 class="media-heading">MarkDown基本用法和标签插件示例</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2016年3月2日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>MarkDown基础用法及其代码<br></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-left">
                        <a class="link-unstyled" href="http://blog.xiaodongwang.com/2016/03/15/29740/">
                            <img class="media-image" src="//d1u9biwaxjngwg.cloudfront.net/image-gallery-showcase/city-140.jpg" width="90" height="90"/>
                        </a>
                    </div>
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://blog.xiaodongwang.com/2016/03/15/29740/">
                            <h3 class="media-heading">代码高亮</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2016年3月15日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>对常用的语言增加了高亮处理，下面是一些高亮的代码Demo<br></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-left">
                        <a class="link-unstyled" href="http://blog.xiaodongwang.com/2016/04/15/25939/">
                            <img class="media-image" src="//oxyk7k4jh.bkt.clouddn.com/2017-12-12-IMG_2367-1.jpg?imageView/3/w/200/h/200" width="90" height="90"/>
                        </a>
                    </div>
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://blog.xiaodongwang.com/2016/04/15/25939/">
                            <h3 class="media-heading">云南旅游</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2016年4月15日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>说走就走<br></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-left">
                        <a class="link-unstyled" href="http://blog.xiaodongwang.com/2016/04/20/56707/">
                            <img class="media-image" src="//oxyk7k4jh.bkt.clouddn.com/2017-12-12-IMG_2588.jpg?imageView/3/w/200/h/200" width="90" height="90"/>
                        </a>
                    </div>
                    
                    <div class="media-body">
                        <a class="link-unstyled" href="http://blog.xiaodongwang.com/2016/04/20/56707/">
                            <h3 class="media-heading">乃心</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    2016年4月20日
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>人生中最美好的就是和你爱着的人，一起看过的风景，还有一路留下的记忆.<br></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
            </div>
        </div>
        <div class="modal-footer">
            <p class="results-count text-medium"
                data-message-zero="没有找到文章"
                data-message-one="找到 1 篇文章"
                data-message-other="找到 {n} 篇文章">
                找到 29 篇文章
            </p>
        </div>
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->
<script src="/assets/js/script-qntsxbjpc0rzur0iyh2ouu1eqzikhak7ouydyddbftzlkn70rn9t8s15aukv.min.js"></script>
<!--SCRIPTS END-->

    
        <script type="text/javascript">
            (function() {
                function render() {
                    new Gitment({
                        id: 'http://blog.xiaodongwang.com/2017/10/10/61606/',
                        owner: 'wxd19891212',
                        repo: 'wxd19891212.github.io',
                        oauth: {
                            client_id: '7e5fbba2de6f10d9d7c5',
                            client_secret: 'e73a2d8bafdf647b1aaf69756465ecb201a33c5c',
                        }
                    }).render('gitment');
                }
                var gc = document.createElement('script');
                gc.type = 'text/javascript';
                gc.src = '//imsun.github.io/gitment/dist/gitment.browser.js';
                gc.charset = 'UTF-8';
                gc.onload = render;
                gc.async = true;
                document.querySelector('body').appendChild(gc);
                var gcs = document.createElement('link');
                gcs.href = '//imsun.github.io/gitment/style/default.css';
                gcs.type = 'text/css';
                gcs.rel = 'stylesheet';
                gcs.media = 'screen,print';
                document.querySelector('head').appendChild(gcs);
            })();
	    </script>
    


    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.14.1/moment-with-locales.min.js"></script>
    <script src="//cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script>
    <script>
        var algoliaClient = algoliasearch('SY89XTQU4C', '4e0dcf7681d496382f94724a1b79b88d');
        var algoliaIndex = algoliaClient.initIndex('wxdblog');
    </script>


    </body>
</html>
